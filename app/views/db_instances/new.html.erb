<div class="container">
  <div class="innerWrap">
    <h3>Launch your GenieDB Instance</h3>

    <div class="innerDiv row-fluid">
      <div class="topNav">
        <a href="javascript:void(0)" class="<%= return_active_class("basic", @db_instance.current_step) %>"><span class="numValue">1</span>DB Instance Details</a>
        <a href="javascript:void(0)" class="<%= return_active_class("management", @db_instance.current_step) %>"><span class="numValue">2</span>Management Options</a>
        <a href="javascript:void(0)" class="<%= return_active_class("confirmation", @db_instance.current_step) %>"><span class="numValue">3</span>Review</a>
      </div>

      <%= form_for(@db_instance, :validate => true) do |f| %>
        <%= render :partial => "#{@db_instance.current_step}_step", :locals => {:f => f} %>

        <div class="control-group">
          <label class="control-label"></label>

          <div class="controls btnWrap">
            <% unless @db_instance.first_step? %>
              <%= f.submit "Back", :class => "backBtn continueBtn", :name => "back_button" %>
            <% end %>
            <% if @db_instance.last_step? %>
              <%= f.submit "Save", :class => "continueBtn", :id => "step_three" do %>
              <% end %>
            <% else %>
              <%= f.submit "Continue", :class => "continueBtn", :id => "step_two" do %>
              <% end %>
            <% end %>
          </div>
        </div>

      <% end %>
    </div>
  </div>
</div>

<script>
  var instance_types = [
    <% NodeSize.all.each do |node_size| %>
      {id:<%=node_size.id%>,cpus:<%=node_size.cpu%>,ram:<%=node_size.ram%>,name:"<%=node_size.name%>"},
    <% end %>
  ];

  function adjust_instance_types() {
    var cpus = $("#cpu_count")[0].options[$("#cpu_count")[0].selectedIndex].text;
    var ram = $("#ram_amount")[0].options[$("#ram_amount")[0].selectedIndex].text;
    var select = $("#db_instance_node_size_id")[0];
    for(var i = select.options.length-1; i >= 0; i--){
      select.remove(i);
    }
    instance_types.forEach(function(el, i, arr){
      if(el.ram == ram && el.cpus == cpus) {
        opt = document.createElement("option");
        opt.text = el.name;
        opt.value= el.id;
        select.add(opt);
      }
    });
    $("#step_two")[0].disabled = select.options.length == 0;
    if(select.options.length != 0)
      select.options.selectedIndex=0;
  }

  $(function () {
    var select = $("#cpu_count");
    var slider = $("<div id='slider'></div>").insertAfter(select).slider({
      min: 1,
      max: <%= CpuOptions.length %>,
      range: "min",
      value: select[ 0 ].selectedIndex + 1,
      slide: function (event, ui) {
        select[ 0 ].selectedIndex = ui.value - 1;
        adjust_instance_types();
      }
    });
    $("#cpu_count").change(function () {
      slider.slider("value", this.selectedIndex + 1);
      adjust_instance_types();
    });
  });

  $(function () {
    var select = $("#ram_amount");
    var slider = $("<div id='slider'></div>").insertAfter(select).slider({
      min: 1,
      max: <%= RamOptions.length %>,
      range: "min",
      value: select[ 0 ].selectedIndex + 1,
      slide: function (event, ui) {
        select[ 0 ].selectedIndex = ui.value - 1;
        adjust_instance_types();
      }
    });
    $("#ram_amount").change(function () {
      slider.slider("value", this.selectedIndex + 1);
      adjust_instance_types();
    });
    adjust_instance_types();
  });
</script>
